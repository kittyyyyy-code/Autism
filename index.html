<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Kitty World</title>
<style>
  html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    background: #b7eaff;
    overflow: hidden;
    touch-action: none;
    font-family: "Poppins", sans-serif;
  }

  #game {
    position: relative;
    width: 100vw; height: 100vh;
    background: url('place_meadow.png') center/cover no-repeat;
    overflow: hidden;
  }

  #kitty {
    position: absolute;
    width: 128px; height: 128px;
    background: url('kitty_stand.png') center/contain no-repeat;
    image-rendering: pixelated;
  }

  #nameTag {
    position: absolute;
    top: -25px; left: 0;
    width: 128px;
    text-align: center;
    color: white;
    font-weight: bold;
    text-shadow: 1px 1px 4px #000;
    font-size: 16px;
  }

  #joystick {
    position: absolute;
    bottom: 30px; left: 30px;
    width: 140px; height: 140px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.4);
    touch-action: none;
  }

  #knob {
    position: absolute;
    width: 60px; height: 60px;
    top: 40px; left: 40px;
    border-radius: 50%;
    background: rgba(255,255,255,0.8);
    transition: 0.05s;
  }
</style>
</head>
<body>

<div id="game">
  <div id="kitty">
    <div id="nameTag"></div>
  </div>
  <div id="joystick"><div id="knob"></div></div>
</div>

<script>
  const kitty = document.getElementById("kitty");
  const nameTag = document.getElementById("nameTag");
  const joystick = document.getElementById("joystick");
  const knob = document.getElementById("knob");

  let username = prompt("Enter your username:");
  if (!username) username = "Kitty";
  nameTag.textContent = username;

  let pos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
  let vel = { x: 0, y: 0 };
  let joy = { active: false, startX: 0, startY: 0, x: 0, y: 0 };

  const speed = 3;
  let frame = 0;
  let dir = "front";

  function moveKitty() {
    pos.x += vel.x;
    pos.y += vel.y;

    // Keep kitty inside screen
    pos.x = Math.max(0, Math.min(window.innerWidth - 128, pos.x));
    pos.y = Math.max(0, Math.min(window.innerHeight - 128, pos.y));

    kitty.style.left = pos.x + "px";
    kitty.style.top = pos.y + "px";

    // Choose correct sprite
    if (vel.x === 0 && vel.y === 0) {
      kitty.style.backgroundImage = "url('kitty_stand.png')";
    } else {
      frame++;
      if (dir === "front")
        kitty.style.backgroundImage = `url('kitty_walk_front${(Math.floor(frame/10)%2)+1}.png')`;
      if (dir === "back")
        kitty.style.backgroundImage = `url('kitty_walk_back${(Math.floor(frame/10)%2)+1}.png')`;
      if (dir === "side")
        kitty.style.backgroundImage = `url('kitty_walk_side${(Math.floor(frame/10)%2)+1}.png')`;
      kitty.style.transform = vel.x < 0 ? "scaleX(-1)" : "scaleX(1)";
    }

    nameTag.style.left = "0px";
    nameTag.style.top = "-25px";

    requestAnimationFrame(moveKitty);
  }

  // Joystick controls
  joystick.addEventListener("touchstart", e => {
    joy.active = true;
    joy.startX = e.touches[0].clientX;
    joy.startY = e.touches[0].clientY;
  });

  joystick.addEventListener("touchmove", e => {
    if (!joy.active) return;
    const x = e.touches[0].clientX - joy.startX;
    const y = e.touches[0].clientY - joy.startY;
    joy.x = Math.max(-50, Math.min(50, x));
    joy.y = Math.max(-50, Math.min(50, y));
    knob.style.left = 40 + joy.x + "px";
    knob.style.top = 40 + joy.y + "px";

    vel.x = (joy.x / 50) * speed;
    vel.y = (joy.y / 50) * speed;

    // Set direction
    if (Math.abs(vel.x) > Math.abs(vel.y)) dir = "side";
    else if (vel.y > 0) dir = "front";
    else dir = "back";
  });

  joystick.addEventListener("touchend", () => {
    joy.active = false;
    vel.x = vel.y = 0;
    knob.style.left = "40px";
    knob.style.top = "40px";
  });

  // Mouse/keyboard (for PC testing)
  window.addEventListener("keydown", e => {
    if (e.key === "ArrowUp" || e.key === "w") { vel.y = -speed; dir = "back"; }
    if (e.key === "ArrowDown" || e.key === "s") { vel.y = speed; dir = "front"; }
    if (e.key === "ArrowLeft" || e.key === "a") { vel.x = -speed; dir = "side"; kitty.style.transform = "scaleX(-1)"; }
    if (e.key === "ArrowRight" || e.key === "d") { vel.x = speed; dir = "side"; kitty.style.transform = "scaleX(1)"; }
  });
  window.addEventListener("keyup", e => {
    vel = { x: 0, y: 0 };
  });

  moveKitty();
</script>

</body>
</html>
